{"ast":null,"code":"import { attributeRules } from \"./attributes.js\";\nimport { compilePseudoSelector } from \"./pseudo-selectors/index.js\";\nimport { SelectorType } from \"css-what\";\nfunction getElementParent(node, adapter) {\n  const parent = adapter.getParent(node);\n  if (parent && adapter.isTag(parent)) {\n    return parent;\n  }\n  return null;\n}\n/*\r\n * All available rules\r\n */\nexport function compileGeneralSelector(next, selector, options, context, compileToken) {\n  const {\n    adapter,\n    equals\n  } = options;\n  switch (selector.type) {\n    case SelectorType.PseudoElement:\n      {\n        throw new Error(\"Pseudo-elements are not supported by css-select\");\n      }\n    case SelectorType.ColumnCombinator:\n      {\n        throw new Error(\"Column combinators are not yet supported by css-select\");\n      }\n    case SelectorType.Attribute:\n      {\n        if (selector.namespace != null) {\n          throw new Error(\"Namespaced attributes are not yet supported by css-select\");\n        }\n        if (!options.xmlMode || options.lowerCaseAttributeNames) {\n          selector.name = selector.name.toLowerCase();\n        }\n        return attributeRules[selector.action](next, selector, options);\n      }\n    case SelectorType.Pseudo:\n      {\n        return compilePseudoSelector(next, selector, options, context, compileToken);\n      }\n    // Tags\n    case SelectorType.Tag:\n      {\n        if (selector.namespace != null) {\n          throw new Error(\"Namespaced tag names are not yet supported by css-select\");\n        }\n        let {\n          name\n        } = selector;\n        if (!options.xmlMode || options.lowerCaseTags) {\n          name = name.toLowerCase();\n        }\n        return function tag(elem) {\n          return adapter.getName(elem) === name && next(elem);\n        };\n      }\n    // Traversal\n    case SelectorType.Descendant:\n      {\n        if (options.cacheResults === false || typeof WeakSet === \"undefined\") {\n          return function descendant(elem) {\n            let current = elem;\n            while (current = getElementParent(current, adapter)) {\n              if (next(current)) {\n                return true;\n              }\n            }\n            return false;\n          };\n        }\n        // @ts-expect-error `ElementNode` is not extending object\n        const isFalseCache = new WeakSet();\n        return function cachedDescendant(elem) {\n          let current = elem;\n          while (current = getElementParent(current, adapter)) {\n            if (!isFalseCache.has(current)) {\n              if (adapter.isTag(current) && next(current)) {\n                return true;\n              }\n              isFalseCache.add(current);\n            }\n          }\n          return false;\n        };\n      }\n    case \"_flexibleDescendant\":\n      {\n        // Include element itself, only used while querying an array\n        return function flexibleDescendant(elem) {\n          let current = elem;\n          do {\n            if (next(current)) return true;\n          } while (current = getElementParent(current, adapter));\n          return false;\n        };\n      }\n    case SelectorType.Parent:\n      {\n        return function parent(elem) {\n          return adapter.getChildren(elem).some(elem => adapter.isTag(elem) && next(elem));\n        };\n      }\n    case SelectorType.Child:\n      {\n        return function child(elem) {\n          const parent = adapter.getParent(elem);\n          return parent != null && adapter.isTag(parent) && next(parent);\n        };\n      }\n    case SelectorType.Sibling:\n      {\n        return function sibling(elem) {\n          const siblings = adapter.getSiblings(elem);\n          for (let i = 0; i < siblings.length; i++) {\n            const currentSibling = siblings[i];\n            if (equals(elem, currentSibling)) break;\n            if (adapter.isTag(currentSibling) && next(currentSibling)) {\n              return true;\n            }\n          }\n          return false;\n        };\n      }\n    case SelectorType.Adjacent:\n      {\n        if (adapter.prevElementSibling) {\n          return function adjacent(elem) {\n            const previous = adapter.prevElementSibling(elem);\n            return previous != null && next(previous);\n          };\n        }\n        return function adjacent(elem) {\n          const siblings = adapter.getSiblings(elem);\n          let lastElement;\n          for (let i = 0; i < siblings.length; i++) {\n            const currentSibling = siblings[i];\n            if (equals(elem, currentSibling)) break;\n            if (adapter.isTag(currentSibling)) {\n              lastElement = currentSibling;\n            }\n          }\n          return !!lastElement && next(lastElement);\n        };\n      }\n    case SelectorType.Universal:\n      {\n        if (selector.namespace != null && selector.namespace !== \"*\") {\n          throw new Error(\"Namespaced universal selectors are not yet supported by css-select\");\n        }\n        return next;\n      }\n  }\n}","map":{"version":3,"mappings":"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","names":["attributeRules","compilePseudoSelector","SelectorType","getElementParent","node","adapter","parent","getParent","isTag","compileGeneralSelector","next","selector","options","context","compileToken","equals","type","PseudoElement","Error","ColumnCombinator","Attribute","namespace","xmlMode","lowerCaseAttributeNames","name","toLowerCase","action","Pseudo","Tag","lowerCaseTags","tag","elem","getName","Descendant","cacheResults","WeakSet","descendant","current","isFalseCache","cachedDescendant","has","add","flexibleDescendant","Parent","getChildren","some","Child","child","Sibling","sibling","siblings","getSiblings","i","length","currentSibling","Adjacent","prevElementSibling","adjacent","previous","lastElement","Universal"],"sourceRoot":"https://raw.githubusercontent.com/fb55/css-select/0f0725a9dfeddd2fdb54eda9656cdbab5bbf6be6/src/","sources":["general.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}